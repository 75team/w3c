浏览器领域，我们有如selenium和puppeteer这样的库，可以自动化控制浏览器执行自动化脚本，以完成自动化端对端测试、定时自动化任务等。随着持续集成、持续部署也就是CI/CD的需求日益增长，自动化也成为必不可少的一环。

对于日益增长的小程序开发需求，我们能不能自动化控制小程序呢，进而达成自动测试、自动发布等任务呢？

针对微信小程序，自2019年5月，微信官方也开始提供了一个官方的自动化SDK：`miniprogram-automator`。这是一个通过NodeJS操控开发者工具以及远程真机中微信的SDK。通过这个SDK，可以控制小程序跳转到指定页面、获取小程序页面数据、获取小程序页面元素状态、触发小程序元素绑定事件、往 AppService 注入代码片段、调用 wx 对象上任意接口等等。

这个SDK可以通过脚本控制本机的微信开发者工具来近似达到自动化测试业务的目的，同时，也可通过远程控制真机，达到真机测试的目的。

我们首先来体验一下这个SDK。

首先，你需要确保你安装了微信开发者工具，并且版本大于1.02.1907232，并设置你的基础库版本在2.7.3以上，同时请安装NodeJS 8.0以上的版本。

![基础库版本](https://p5.ssl.qhimg.com/t0120195edb943d0b7a.jpg)

此时，通过：`npm i miniprogram-automator --save-dev`或 `yarn add miniprogram-automator --dev` 即可安装`miniprogram-automator`

为了保证开发者工具能够通过命令行打开，需要将开发者工具的HTTP服务调用接口打开。

打开方式有两种：

第一、通过微信开发者工具打开。进入微信开发者工具，选择：设置 > 安全设置。在服务端口中选择：打开。

![](https://p1.ssl.qhimg.com/t01c8c6b97819cd02af.jpg)

第二、通过命令行确保打开。

首先需要找到微信开发者工具的安装目录。不同的操作系统位置不同。Mac位于:<安装路径>/Contents/MacOS/cli，windows位于: <安装路径>/cli.bat。对于经常使用的同学，建议放在系统的环境变量中。


