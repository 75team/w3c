### 引子

2019年5月20日，科技界最火爆的消息莫过于[谷歌暂停支持华为部分业务](http://www.xinhuanet.com/tech/2019-05/20/c_1124519710.htm)。关于这个事件将产生的影响，大家可以从相关的科技媒体上找到详细的分析。比较一致的看法是：谷歌的这个做法，对于国内的华为用户，影响不大；对于海外的华为用户，尤其是在上游应用生态环境上，会有一定的影响。

这是由于，谷歌暂停合作的服务，都是在用户层面的服务GMS。用户层与安卓底层内核尊从不同的协议，因此不必开源，进而导致替换成本高企。基于现有生态，在海外市场构建应用生态环境难度非常大。

这篇文章将尝试从这则新闻涉及的开源协议来分析一下，这个做法背后相关的逻辑，并籍此，跟各位读者聊一聊主流的开源协议。

### 安卓与开源协议

开源软件或称自由软件是自由获取，源代码开放的，人们可以自由地获取和使用这些软件。同时，为了维护开发者和贡献者的合法权利，使得软件能够更好的被使用并不影响软件的正常发展，开源社区开发出了各种开源协议。软件开发者可以根据软件的属性和自身需要的权责主张选择合适的开源协议；下载并使用这些软件的用户，原则上，要求遵守开源协议的要求。

众所周知，安卓系统是基于Linux的。而Linux本身是基于GPL(GNU General Public License)v2开源协议的。GPL协议规定，只要这种修改文本在整体上或者其某个部分来源于遵循GPL的程序，该修改文本的整体就必须按照GPL流通，不仅该修改文本的源码必须向社会公开，而且对于这种修改文本的流通不准许附加修改者自己作出的限制。

用通俗的语言来讲，只要一个软件使用了采用GPL开源协议的开源软件，则在分发、传播、发布过程中，必须一并开放源代码。则这个软件也就成为了GPL开源协议的软件。这被称为GPL协议的“传染性”。

笔者曾经研究过一个开源的多边形矢量化算法名曰：[Potrace](http://potrace.sourceforge.net)。因为高效的算法被广泛采用。由于其创始人使用GPL协议，因此，所有基于此算法的软件，也都清一色的使用了GPL协议。

按照这个逻辑，基于Linux的安卓，也应该开源所有的技术代码，即遵循GPLv2协议。然而，这在现实中并没有发生，原因是安卓系统本身并不是遵循GPL协议的，而是采用了对商业友好的ASL(Apache Software License)。该协议不强制要求后续代码开源，也为安卓上层软件、驱动等商业活动打好了基础。

那么现在问题变成了，为什么基于GPL协议的软件开发的安卓可以采用ASL呢？说好的“传染性”呢？

首先说明，“传染性”的边界在哪？Linux内核的作者Linus以及内核开发人员多次强调普通系统调用为不是 GPL 的作用范围。大家在 Linux 内核的源码 COPYING 文档中也可以找到[这些文字](https://github.com/torvalds/linux/blob/master/LICENSES/exceptions/Linux-syscall-note)。这些澄清为 Linux 用户空间的程序采用非 GPL 的授权许可证打好了基础。

![](https://p3.ssl.qhimg.com/t01c480a7f432df6e9c.jpg)

好的，既然系统调用可以不是GPL的管辖范围。这里面谷歌做了一件事情，就是把原来在内核层的驱动剥离出来，在内核中留有调用接口。并把驱动等部分提升到用户空间，形成HAL(Hardware Abstraction Layer)。一方面起到了对硬件驱动层进行抽象，防止有问题的驱动对于内核的影响，同时也把GPL的影响控制在“内核层”。

![](https://p1.ssl.qhimg.com/t01722fb014602270c5.png)

上图是 [Openfoundry](http://www.openfoundry.org/)绘制的安卓授权许可证结构。仅仅内核部分使用了GPL2.0。

![](https://p5.ssl.qhimg.com/t01c39b97d5bd9c2b64.jpg)

